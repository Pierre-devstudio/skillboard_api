<!-- static/menus/skills_entretien_performance.html -->
<section id="view-entretien-performance" style="display:none;">

  <div class="card">
    <div class="card-title">Entretien de performance</div>
    <div class="card-sub">Assistant d’entretien individuel (audit compétences + mise à jour des données Skills)</div>

    <div style="margin-top:10px; display:flex; gap:8px; align-items:center;">
      <button class="btn-secondary" id="ep_btnHelpScoring" type="button">Règles de scoring</button>
      <button class="btn-secondary" id="ep_btnHistoryGlobal" type="button">Historique</button>
      <button class="btn-secondary" id="ep_btnFinalize" type="button" disabled>Finaliser</button>
    </div>
  </div>

  <!-- Contexte entretien -->
  <div class="card" style="margin-top:12px;">
    <div class="card-header">
      <div class="card-title">Contexte</div>   
    </div>

    <div class="card-body">
      <div class="row" style="gap:12px; margin-top:6px; flex-wrap:wrap;">
        <div class="info-item" style="min-width:160px;">
          <div class="label">Collaborateur</div>
          <div class="value" id="ep_ctxCollaborateur">—</div>
        </div>

        <div class="info-item" style="min-width:160px;">
          <div class="label">Matricule</div>
          <div class="value" id="ep_ctxMatricule">—</div>
        </div>

        <div class="info-item" style="min-width:160px;">
          <div class="label">Poste</div>
          <div class="value" id="ep_ctxPoste">—</div>
        </div>
        <div class="info-item" style="min-width:160px;">
          <div class="label">Service</div>
          <div class="value" id="ep_ctxService">—</div>
        </div>
        <div class="info-item" style="min-width:160px;">
          <div class="label">Date</div>
          <div class="value" id="ep_ctxDate">—</div>
        </div>
      </div>


      <div class="row" style="gap:12px; margin-top:12px; flex-wrap:wrap;">
        <div class="card" style="padding:12px; margin:0; flex:1; min-width:160px;">
          <div class="label">Compétences jamais auditées</div>
          <div class="value" id="ep_kpiToDo">0</div>
        </div>        
      </div>
    </div>
  </div>

  <div class="sb-split" style="margin-top:12px; gap:12px;">
    <!-- Colonne gauche: Périmètre + Sélection collaborateur + Checklist -->
    <div class="sb-col" style="min-width:320px; max-width:380px;">
      <!-- Périmètre -->
      <div class="card" id="ep_cardPerimetre">
        <div class="card-title">Périmètre</div>
        <div class="card-sub">Filtrer les collaborateurs à auditer.</div>

        <div class="row" style="flex-direction:column; gap:12px; margin-top:12px;">
          <div class="info-item" style="min-width:0;">
            <div class="label">Service</div>
            <select id="ep_selService">
              <option value="">— Sélectionner —</option>
            </select>
          </div>

          <div class="info-item" style="min-width:0;">
            <button type="button" class="btn-secondary" id="ep_btnScopeReset" style="margin-left:0; width:100%;">Réinitialiser</button>
          </div>
        </div>
      </div>

      <!-- Sélection collaborateur -->
      <div class="card" style="margin-top:12px;">
        <div class="card-header">
          <div class="card-title">Collaborateurs</div>
          <div class="card-sub" id="ep_collabCount">0</div>
        </div>
        <div class="card-body">
          <div class="sb-field">
            <label class="sb-label" for="ep_txtSearchCollab">Recherche</label>
            <input id="ep_txtSearchCollab"  placeholder="Nom, prénom, code..." />
          </div>

          <div class="sb-list" id="ep_listCollaborateurs" style="margin-top:10px; max-height:260px; overflow:auto;">
            <!-- items -->
          </div>

          <div class="card-sub" style="margin-top:8px;">
            Sélectionne un collaborateur pour démarrer l’entretien.
          </div>
        </div>
      </div>

      <!-- Checklist compétences -->
      <div class="card" style="margin-top:12px;">
        <div class="card-header">
          <div class="card-title">Compétences à auditer</div>
          <div class="card-sub" id="ep_compCount">0</div>
        </div>
        <div class="card-body">
          <div class="sb-field">
            <label class="sb-label" for="ep_txtSearchComp">Filtrer compétences</label>
            <input id="ep_txtSearchComp"  placeholder="Code, intitulé, mots-clés..." />
          </div>

          <div class="table-wrap" style="margin-top:10px; max-height:340px; overflow:auto;">
            <table class="sb-table" id="ep_tblCompetences">
              <thead>
                <tr>
                  <th>Compétence</th>
                </tr>
              </thead>
              <tbody>
                <!-- rows -->
              </tbody>
            </table>
          </div>

          <div class="card-sub" style="margin-top:8px;">
            Badge rouge = compétence jamais auditée.
          </div>


        </div>
      </div>
    </div>

    <!-- Centre: fiche évaluation compétence -->
    <div class="sb-col">
      <div class="card" id="ep_cardEvaluation">
        <div class="card-header">
          <div class="card-title">Évaluation</div>
          <div class="card-sub" id="ep_evalHint">Sélectionne une compétence dans la liste de gauche.</div>
        </div>

        <div class="card-body">
          <!-- En-tête compétence -->
          <div class="sb-grid-2">
            <div>
              <div class="sb-label"><b>Compétence</b></div>
              <div class="sb-value" id="ep_compTitle">—</div>

              <!-- Domaine en badge (texte alimenté par le JS via id ep_compDomain) -->
              <div style="margin-top:6px;">
                <span class="sb-badge" id="ep_compDomain" style="display:inline-block;"></span>
              </div>
            </div>
            <div>
              <div class="sb-label"><b>Niveau de maîtrise actuel</b></div>
              <div class="sb-value" id="ep_compCurrent">—</div>
              <div class="card-sub" id="ep_compLastEval" style="margin-top:4px;"></div>
            </div>
          </div>


          <hr class="sb-sep" style="margin:14px 0;" />

          <!-- Critères -->
          <div class="card-sub" style="margin-bottom:8px;">
            Notes de 1 à 4. Le calcul du score final est pondéré pour ramener sur 24.
          </div>

          <div class="table-wrap">
            <table class="sb-table" id="ep_tblCriteres">
              <thead>
                <tr>
                  <th style="width:65%;">Critère</th>
                  <th style="width:15%;">Note</th>
                  <th style="width:20%;">Commentaire</th>
                </tr>
              </thead>
              <tbody>
                <tr data-crit="1">
                  <td><span id="ep_critLabel1">—</span></td>
                  <td>
                    <select id="ep_critNote1"  disabled>
                      <option value="">—</option>
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4">4</option>
                    </select>
                  </td>
                  <td><input id="ep_critCom1"  disabled /></td>
                </tr>

                <tr data-crit="2">
                  <td><span id="ep_critLabel2">—</span></td>
                  <td>
                    <select id="ep_critNote2"  disabled>
                      <option value="">—</option>
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4">4</option>
                    </select>
                  </td>
                  <td><input id="ep_critCom2"  disabled /></td>
                </tr>

                <tr data-crit="3">
                  <td><span id="ep_critLabel3">—</span></td>
                  <td>
                    <select id="ep_critNote3"  disabled>
                      <option value="">—</option>
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4">4</option>
                    </select>
                  </td>
                  <td><input id="ep_critCom3"  disabled /></td>
                </tr>

                <tr data-crit="4">
                  <td><span id="ep_critLabel4">—</span></td>
                  <td>
                    <select id="ep_critNote4"  disabled>
                      <option value="">—</option>
                      <option value="1">1</option>
                      <option value="2">2</option>
                      <option value="3">3</option>
                      <option value="4">4</option>
                    </select>
                  </td>
                  <td><input id="ep_critCom4"  disabled /></td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- Résultats calcul -->
          <div class="row" style="gap:12px; margin-top:12px; flex-wrap:wrap;">
            <div class="card" style="padding:12px; margin:0; flex:1; min-width:160px;">
              <div class="label">Somme brute</div>
              <div class="value" id="ep_scoreRaw">—</div>
            </div>

            <div class="card" style="padding:12px; margin:0; flex:1; min-width:160px;">
              <div class="label">Coef.</div>
              <div class="value" id="ep_scoreCoef">—</div>
            </div>

            <div class="card" style="padding:12px; margin:0; flex:1; min-width:160px;">
              <div class="label">Score /24</div>
              <div class="value" id="ep_score24">—</div>
            </div>

            <div class="card" style="padding:12px; margin:0; flex:1; min-width:160px;">
              <div class="label">Niveau</div>
              <div class="value" id="ep_levelABC">—</div>
            </div>
          </div>


          <div class="sb-field" style="margin-top:12px;">
            <label class="sb-label" for="ep_txtObservation">Observation</label>
            <textarea id="ep_txtObservation"  rows="4" placeholder="Faits observables, exemples, contexte..." disabled></textarea>
          </div>

          <div class="sb-actions" style="margin-top:12px; display:flex; align-items:center; gap:10px;">
            <div id="ep_saveMsg" class="card-sub" style="margin:0; display:none;"></div>

            <button class="btn-secondary" id="ep_btnSave" type="button" disabled>Enregistrer</button>
          </div>

        </div>
      </div>
    </div>

    <!-- Droite: synthèse / plan d'action -->
    <div class="sb-col" style="min-width:320px; max-width:380px;">
      <div class="card" id="ep_cardCouverturePoste">
        <div class="card-header">
          <div class="card-title">Couverture poste actuel</div>
          <div class="card-sub">Écart entre les compétences du salarié et les attendus du poste.</div>
        </div>

        <div class="card-body">
          <div class="card-sub" id="ep_covHint" style="margin-top:0;">
            Sélectionne un collaborateur pour afficher la couverture du poste.
          </div>

          <div id="ep_covWrap" style="display:none;">
            <div style="display:flex; justify-content:center; margin-top:10px;">
              <svg id="ep_svgGauge"
                  viewBox="0 0 240 150"
                  style="width:100%; max-width:320px; height:auto; display:block;">
              </svg>
            </div>

            <div style="text-align:center; margin-top:8px;">
              <span id="ep_covPctPoste" style="font-weight:800; font-size:22px;">—</span>
              <span style="margin:0 8px; color:var(--muted);">-</span>
              <span id="ep_covPctMax" style="font-style:italic; font-size:14px; color:var(--muted);">—</span>
            </div>

            <div style="margin-top:10px; display:flex; justify-content:center;">
              <label class="sb-switch">
                <input type="checkbox" id="ep_chkPondere" />
                <span>Pondérer par criticité</span>
              </label>
            </div>

            <div class="card-sub" style="margin-top:8px; text-align:center;">
              L’aiguille indique le score actuel. La zone colorée représente la plage attendue du poste.
            </div>
          </div>
        </div>
      </div>


      <div class="card" style="margin-top:12px;">
        <div class="card-header">
          <div class="card-title">Plan d’action</div>
          <div class="card-sub">Objectifs, formations, mobilité</div>
        </div>
        <div class="card-body">
          <div class="sb-field">
            <label class="sb-label" for="ep_txtGlobalNotes">Notes globales</label>
            <textarea id="ep_txtGlobalNotes"  rows="6" placeholder="Synthèse entretien, objectifs, axes de progrès..." disabled></textarea>
          </div>

          <button class="btn-secondary" id="ep_btnGenerateSummary" type="button" style="margin-top:10px; width:100%;" disabled>
            Générer une synthèse
          </button>
        </div>
      </div>

      <div class="card" style="margin-top:12px;">
        <div class="card-header">
          <div class="card-title">Mode Focus</div>
          <div class="card-sub">Agrandit la zone d’évaluation</div>
        </div>
        <div class="card-body">
          <label class="sb-switch">
            <input type="checkbox" id="ep_chkFocus" />
            <span>Activer le mode Focus</span>
          </label>
          <div class="card-sub" style="margin-top:8px;">
            Masque la colonne de droite pour se concentrer sur l’évaluation.
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal: règles de scoring -->
  <div class="modal" id="modalEpScoring" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <div style="font-weight:600;">Règles de scoring</div>
        <button type="button" class="modal-x" id="btnCloseEpScoringModalX" aria-label="Fermer">×</button>
      </div>

      <div class="modal-body">
        <div class="card-sub" style="margin-top:0;">
          Chaque compétence peut avoir entre 1 et 4 critères (notes 1 à 4). La somme est pondérée pour obtenir un score sur 24.
        </div>

        <div class="table-wrap" style="margin-top:10px;">
          <table class="sb-table">
            <thead>
              <tr>
                <th>Nb critères</th>
                <th>Coefficient</th>
                <th>Score min</th>
                <th>Score max</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>4</td><td>1,5</td><td>6</td><td>24</td></tr>
              <tr><td>3</td><td>2</td><td>6</td><td>24</td></tr>
              <tr><td>2</td><td>3</td><td>6</td><td>24</td></tr>
              <tr><td>1</td><td>6</td><td>6</td><td>24</td></tr>
            </tbody>
          </table>
        </div>

        <div class="table-wrap" style="margin-top:12px;">
          <table class="sb-table">
            <thead>
              <tr>
                <th>Niveau</th>
                <th>Libellé</th>
                <th>Plage score /24</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>A</td><td>Initial</td><td>6 à 9</td></tr>
              <tr><td>B</td><td>Avancé</td><td>10 à 18</td></tr>
              <tr><td>C</td><td>Expert</td><td>19 à 24</td></tr>
            </tbody>
          </table>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-secondary" id="btnEpScoringModalClose">Fermer</button>
      </div>
    </div>
  </div>


  <!-- Modal: historique (placeholder) -->
  <div class="modal" id="modalEpHistory" aria-hidden="true">
    <div class="modal-card" style="width:calc(100vw - 80px); max-width:1200px;">
      <div class="modal-header">
        <div style="font-weight:600;">Historique</div>
        <button type="button" class="modal-x" id="btnCloseEpHistoryModalX" aria-label="Fermer">×</button>
      </div>

      <div class="modal-body" style="font-size:13px;">
        <div class="card-sub" style="margin-top:0;">
          Historique des audits et/ou de l’entretien.
        </div>

        <!-- Filtres -->
        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; align-items:flex-end;">
          <div style="flex:1; min-width:240px;">
            <div class="sb-label">Recherche</div>
            <input id="ep_histSearch" placeholder="Code, intitulé, mots-clés..." />
          </div>

          <div style="min-width:200px;">
            <div class="sb-label">Évaluateur</div>
            <select id="ep_histSelEvaluateur">
              <option value="">Tous</option>
            </select>
          </div>

          <div style="min-width:220px;">
            <div class="sb-label">Méthode</div>
            <select id="ep_histSelMethode">
              <option value="">Toutes</option>
            </select>
          </div>
        </div>

        <!-- Tableau -->
        <div class="table-wrap" style="margin-top:10px; font-size:13px;">
          <table class="sb-table" id="ep_tblHistory">
            <thead>
              <tr>
                <th style="width:90px;">Date</th>
                <th style="width:170px;">Évaluateur</th>
                <th>Compétence</th>
                <th style="width:140px; text-align:center;">Résultat</th>
                <th style="width:110px;">Observation</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-secondary" id="btnEpHistoryModalClose">Fermer</button>
      </div>
    </div>
  </div>

  <!-- Modal: détail couverture poste -->
  <div class="modal" id="modalEpCoverageDetail" aria-hidden="true">
    <div class="modal-card" style="max-width:1100px; width:calc(100vw - 80px);">
      <div class="modal-header">
        <div style="font-weight:600;">Détail couverture du poste</div>
        <button type="button" class="modal-x" id="btnCloseEpCoverageDetailModalX" aria-label="Fermer">×</button>
      </div>

      <div class="modal-body">
        <div class="card-sub" style="margin-top:0;">
          Détail des compétences attendues pour le poste actuel, avec le niveau requis, la criticité et le niveau du salarié.
        </div>

        <div class="hint" id="ep_covDetailInfo" style="margin-top:8px;"></div>

        <div class="table-wrap" style="margin-top:10px;">
          <table class="sb-table" id="ep_tblCoverageDetail">
            <thead>
              <tr>
                <th>Compétence</th>
                <th class="col-center">Criticité</th>
                <th class="col-center">Niveau requis</th>
                <th class="col-center">Niveau salarié</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-secondary" id="btnEpCoverageDetailModalClose">Fermer</button>
      </div>
    </div>
  </div>


  <!-- Modal Observation (depuis Historique) -->
  <div class="modal" id="modalEpHistoryObs" aria-hidden="true">
    <div class="modal-card" style="max-width:720px;">
      <div class="modal-header">
        <div style="font-weight:600;" id="ep_histObsTitle">Observation</div>
        <button type="button" class="modal-x" id="btnCloseEpHistoryObsModalX" aria-label="Fermer">×</button>
      </div>

      <div class="modal-body" style="font-size:13px;">
        <div class="card-sub" id="ep_histObsMeta" style="margin-top:0;"></div>
        <div id="ep_histObsText" style="margin-top:10px; white-space:pre-wrap;"></div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-secondary" id="btnEpHistoryObsModalClose">Fermer</button>
      </div>
    </div>
  </div>



</section>
