<section id="view-cartographie-competences" style="display:none;">
  <div class="card">
    <div class="card-title">Cartographie des compétences</div>
    <div class="card-sub">
      Visualisez la répartition des compétences requises par poste et par domaine, filtrée par service.
    </div>
  </div>

  <div class="sb-split">
    <!-- Colonne filtres -->
    <div class="sb-col">
      <div class="card">
        <div class="card-title" style="margin-bottom:6px;">Filtres</div>
        <div class="card-sub" style="margin:0;">Lecture “macro” du périmètre. Cliquez sur une cellule pour détailler.</div>

        <div class="row" style="flex-direction:column; gap:12px; margin-top:12px;">
          <div class="info-item" style="min-width:0;">
            <div class="label">Service</div>
            <select id="mapServiceSelect">
              <option value="">Tous les services</option>
            </select>
          </div>

          <div class="info-item" style="min-width:0;">
            <div class="label">Domaine</div>
            <select id="mapDomaineSelect">
              <option value="">Tous les domaines</option>
            </select>
          </div>

          <div class="info-item" style="min-width:0;">
            <button type="button" class="btn-secondary" id="btnMapReset" style="margin-left:0; width:100%;">
              Réinitialiser
            </button>
          </div>
        </div>
      </div>

      <!-- KPI -->
      <div class="card">
        <div class="card-title" style="margin-bottom:6px;">Indicateurs</div>
        <div class="card-sub" style="margin:0;">Synthèse du périmètre affiché.</div>

        <div class="row" style="gap:12px; margin-top:12px; flex-wrap:wrap;">
          <div class="card" style="padding:12px; margin:0; flex:1; min-width:160px;">
            <div class="label">Postes</div>
            <div class="value" id="kpiMapPostes">–</div>
          </div>

          <div class="card" style="padding:12px; margin:0; flex:1; min-width:160px;">
            <div class="label">Domaines</div>
            <div class="value" id="kpiMapDomaines">–</div>
          </div>

          <div class="card" style="padding:12px; margin:0; flex:1; min-width:160px;">
            <div class="label">Compétences (total)</div>
            <div class="value" id="kpiMapCompetences">–</div>
          </div>

          <div class="card" style="padding:12px; margin:0; flex:1; min-width:160px;">
            <div class="label">Périmètre</div>
            <div class="value" id="kpiMapScope">–</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Colonne contenu -->
    <div class="sb-col">
      <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:flex-end; gap:12px; flex-wrap:wrap;">
          <div>
            <div class="card-title" style="margin-bottom:6px;">Matrice Poste × Domaine</div>
            <div class="card-sub" id="mapScopeLabel" style="margin:0;">Chargement…</div>
          </div>

          <div class="card-sub" id="mapCount" style="margin:0;">—</div>
        </div>

        <!-- Heatmap -->
        <div id="wrapHeatmap" style="margin-top:12px;">
          <div class="card-sub" style="margin:0 0 10px 0;">
            Plus la cellule est “chargée”, plus le poste mobilise de compétences dans ce domaine.
          </div>

          <div class="table-wrap" style="overflow:auto;">
            <!-- On génère la grille en JS -->
            <div id="heatmapGrid" class="sb-heatmap"></div>
          </div>
        </div>

        <div class="card-sub" id="mapEmpty" style="display:none; margin-top:10px;">
          Aucun poste/compétence trouvé pour les filtres sélectionnés.
        </div>
      </div>
    </div>
  </div>

  <!-- Modal détail (cellule ou poste/domaine) -->
  <div class="modal" id="modalMapDetail" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <div style="font-weight:600;" id="mapModalTitle">Détail</div>
        <button type="button" class="modal-x" id="btnCloseMapModal" aria-label="Fermer">×</button>
      </div>

      <div class="modal-body">
        <div class="card-sub" id="mapModalSub" style="margin-top:0;"></div>
        <div id="mapModalBody" style="margin-top:12px;"></div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-secondary" id="btnMapModalClose">Fermer</button>
      </div>
    </div>
  </div>
</section>
