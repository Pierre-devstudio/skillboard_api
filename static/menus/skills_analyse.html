<section id="view-analyse-competences" style="display:none;">

<div class="card">
  <div class="card-title">Analyse des compétences</div>
  <div class="card-sub">
    Exploitez la cartographie: risques, matching interne, prévisions. Objectif: décider (former, bouger, recruter).
  </div>
</div>

<div class="sb-split">
  <!-- Colonne gauche: filtres -->
  <div class="sb-col">
    <div class="card">
      <div class="card-title" style="margin-bottom:6px;">Filtres</div>
      <div class="card-sub" style="margin:0;">Le filtre s’applique aux indicateurs et aux listes.</div>

      <div class="sb-stack" style="margin-top:12px;">
        <div class="info-item">
          <div class="label">Service</div>
          <select id="analyseServiceSelect" class="sb-select">
            <option value="__ALL__">Tous les services</option>
          </select>
        </div>

        <div class="info-item">
          <button type="button" class="sb-btn sb-btn--init sb-btn--block" id="btnAnalyseReset">
            Réinitialiser les filtres
          </button>
        </div>

        <div class="info-item">
          <div class="label">Mode actif</div>
          <div class="value" id="analyseModeLabel">Risques</div>
        </div>
      </div>
    </div>
  </div>



  <!-- Colonne droite: tuiles -->
  <div class="sb-col">
    <div class="analyse-tiles sb-tiles">

      <!-- Tuile Risques -->
      <div class="card analyse-tile sb-tile active" id="tileRisques" data-mode="risques" role="button" tabindex="0" aria-label="Ouvrir Risques">
        <div class="card-title" style="margin-bottom:2px;">Risques</div>
        <div class="tile-sub sb-tile-sub">Identifier les fragilités: criticité, couverture, dépendance, concentration.</div>

        <div class="mini-kpis sb-mini-kpis">
          <div class="mini-kpi sb-mini-kpi" data-risk-kpi="postes-fragiles" role="button" tabindex="0" aria-label="Afficher les postes fragiles">
            <div class="label">Postes fragiles</div>
            <div class="value" id="kpiRiskPostes">—</div>
          </div>

          <div class="mini-kpi sb-mini-kpi" data-risk-kpi="critiques-fragiles" role="button" tabindex="0" aria-label="Afficher les compétences critiques structurelles (fragiles)">
            <div class="label">
              Compétences critiques (structurel)
              <span class="sb-badge sb-badge--warning sb-badge--mini" id="kpiRiskCritAlert" style="display:none;"></span>
            </div>
            <div class="value" id="kpiRiskCritFragiles">—</div>
          </div>

          <div class="mini-kpi sb-mini-kpi" data-risk-kpi="evol-3m" role="button" tabindex="0" aria-label="Afficher l’évolution du risque à 3 mois">
            <div class="label">Évolution du risque (3 mois)</div>
            <div class="value" id="kpiRiskEvol3m">—</div>
          </div>


        </div>

        <div class="tile-hint sb-tile-hint">Décision: prioriser transfert de savoir, formation ciblée, sécurisation.</div>
      </div>

      <!-- Tuile Matching -->
      <div class="card analyse-tile sb-tile" id="tileMatching" data-mode="matching" role="button" tabindex="0" aria-label="Ouvrir Matching Poste-porteur">
        <div class="card-title" style="margin-bottom:2px;">Matching</div>
        <div class="tile-sub sb-tile-sub">Trouver les meilleurs candidats internes, maintenant ou à horizon court, avec écarts.</div>

        <div class="mini-kpis sb-mini-kpis">
          <div class="mini-kpi sb-mini-kpi" data-match-view="titulaire" role="button" tabindex="0" aria-label="Afficher l’adéquation au poste (titulaires)">
            <div class="label">Adéquation au poste</div>
            <div class="value">—</div>
          </div>

          <div class="mini-kpi sb-mini-kpi" data-match-view="candidats" role="button" tabindex="0" aria-label="Afficher les top candidats (hors titulaires)">
            <div class="label">Top candidat</div>
            <div class="value">—</div>
          </div>
        </div>

        <div class="tile-hint sb-tile-hint">Décision: mobilité, staffing, succession, plan de montée en compétences.</div>
      </div>

      <!-- Tuile Prévisions -->
      <div class="card analyse-tile sb-tile" id="tilePrevisions" data-mode="previsions" role="button" tabindex="0" aria-label="Ouvrir Prévisions">
        <div class="card-title" style="margin-bottom:2px;">Prévisions</div>
        <div class="tile-sub sb-tile-sub">Projeter la couverture: sorties, scénarios, postes qui passent en rouge.</div>

        <div class="mini-kpis sb-mini-kpis">
          <div class="mini-kpi sb-mini-kpi" data-prev-kpi="sorties" role="button" tabindex="0" aria-label="Afficher sorties">
            <div class="label">Sorties &lt; <span id="prevHorizonLabel">1 an</span></div>
            <div class="value" id="kpiPrevSorties12">—</div>
            <input type="range" id="prevHorizonSlider" min="1" max="5" step="1" value="1"
                   aria-label="Horizon prévision (années)" style="width:100%; margin-top:8px;">
          </div>

          <div class="mini-kpi sb-mini-kpi" data-prev-kpi="critiques" role="button" tabindex="0" aria-label="Afficher compétences impactées">
            <div class="label">Compétences impactées</div>
            <div class="value" id="kpiPrevCompImpact">—</div>
          </div>

          <div class="mini-kpi sb-mini-kpi" data-prev-kpi="postes-rouges" role="button" tabindex="0" aria-label="Afficher postes rouges">
            <div class="label">Postes rouges</div>
            <div class="value" id="kpiPrevPostesRed">—</div>
          </div>
        </div>

        <div class="tile-hint sb-tile-hint">Décision: plan formation/recrutement/mobilité avec horizons.</div>
      </div>

    </div>
  </div>
</div>

<!-- Détail (pleine largeur) -->
<div class="card" style="margin-top:12px;">
  <div style="display:flex; justify-content:space-between; align-items:flex-end; gap:12px; flex-wrap:wrap;">
    <div>
      <div class="card-title" id="analyseDetailTitle" style="margin-bottom:6px;">Risques</div>
      <div class="card-sub" id="analyseDetailSub" style="margin:0;">Liste priorisée à venir.</div>
    </div>
    <div class="card-sub" id="analyseDetailMeta" style="margin:0;">—</div>
  </div>

  <div id="analyseDetailBody" style="margin-top:12px;">
    <div class="card" style="padding:12px; margin:0;">
      <div class="card-sub" style="margin:0;">
        Sélectionnez une tuile pour afficher le contenu. Les listes détaillées arriveront avec l’API dédiée.
      </div>
    </div>
  </div>
</div>


    <!-- Modal détail Poste (Risques) -->
  <div class="modal" id="modalAnalysePoste" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <div id="analysePosteModalTitle" class="modal-title" style="display:flex; gap:8px; align-items:center; min-width:0;">
          <span id="analysePosteModalTitleCode" class="sb-badge sb-badge-ref-poste-code" style="display:none;"></span>
          <span id="analysePosteModalTitleText" style="min-width:0; white-space:nowrap; overflow:hidden; text-overflow:ellipsis;"></span>
        </div>
        <button type="button" class="modal-x" id="btnCloseAnalysePosteModal" aria-label="Fermer">×</button>
      </div>

      <div class="modal-body">
        <div class="card-sub" id="analysePosteModalSub" style="margin-top:0;"></div>        
        <div id="analysePosteTabCompetences" style="margin-top:12px;"></div>
      </div>

      <div class="modal-footer">
        <button type="button" class="sb-btn sb-btn--soft" id="btnAnalysePosteModalClose">Fermer</button>
      </div>
    </div>
  </div>

  <!-- Modal détail Compétence (Prévisions > Critiques impactées) -->
<div class="modal" id="modalAnalysePrevCrit" aria-hidden="true">
  <div class="modal-card" style="max-width:980px;">
    <div class="modal-header">
      <div style="display:flex; flex-direction:column; gap:2px;">
        <div style="font-weight:600;" id="analysePrevCritModalTitle">Détail compétence</div>
        <div class="card-sub" id="analysePrevCritModalSub" style="margin:0;"></div>
      </div>
      <button type="button" class="modal-x" id="btnCloseAnalysePrevCritModal" aria-label="Fermer">×</button>
    </div>

    <div class="modal-body">
      <!-- Bandeau contexte (service + horizon + criticité) -->
      <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:0;">
        <span class="sb-badge sb-badge-accent" id="analysePrevCritBadgeService">Service : —</span>
        <span class="sb-badge" id="analysePrevCritBadgeHorizon">Horizon : —</span>
        <span class="sb-badge" id="analysePrevCritBadgeCriticite">Criticité : —</span>
      </div>

      <!-- Synthèse (fixe) -->
      <div class="card" style="padding:12px; margin-top:12px;">
        <div class="card-title">Synthèse</div>
        <div class="row" style="gap:12px; flex-wrap:wrap;">
          <div class="card" style="padding:10px; margin:0; min-width:180px; flex:1;">
            <div class="label">Porteurs actuels</div>
            <div class="value" id="prevCritKpiNow">—</div>
          </div>
          <div class="card" style="padding:10px; margin:0; min-width:180px; flex:1;">
            <div class="label">Sortants (horizon)</div>
            <div class="value" id="prevCritKpiOut">—</div>
          </div>
          <div class="card" style="padding:10px; margin:0; min-width:180px; flex:1;">
            <div class="label">Restants</div>
            <div class="value" id="prevCritKpiRemain">—</div>
          </div>
          <div class="card" style="padding:10px; margin:0; min-width:180px; flex:1;">
            <div class="label">Postes impactés</div>
            <div class="value" id="prevCritKpiPostes">—</div>
          </div>
          <div class="card" style="padding:10px; margin:0; min-width:260px; flex:2;">
            <div class="label">Prochaine sortie</div>
            <div class="value" id="prevCritKpiNextExit">—</div>
          </div>
        </div>

        <!-- Mini “graphique” (barre niveaux A/B/C) -->
        <div style="margin-top:12px;">
          <div class="label" style="margin-bottom:6px;">Répartition des niveaux (restants)</div>
          <div id="prevCritLevelBar" style="display:flex; height:12px; border:1px solid #e5e7eb; border-radius:999px; overflow:hidden;">
            <div id="prevCritLevelBarA" style="width:0%; background:#f3f4f6;"></div>
            <div id="prevCritLevelBarB" style="width:0%; background:#e5e7eb;"></div>
            <div id="prevCritLevelBarC" style="width:0%; background:#d1d5db;"></div>
          </div>
          <div class="card-sub" id="prevCritLevelBarLegend" style="margin:6px 0 0 0;">A: — • B: — • C: —</div>
        </div>
      </div>

      <!-- Tabs -->
      <div class="sb-segbar" style="margin-top:12px;">
        <button type="button" class="sb-seg sb-seg--soft is-active" id="tabPrevCritSynthese">Synthèse</button>
        <button type="button" class="sb-seg sb-seg--soft" id="tabPrevCritRestants">Porteurs restants</button>
        <button type="button" class="sb-seg sb-seg--soft" id="tabPrevCritSortants">Porteurs sortants</button>
        <button type="button" class="sb-seg sb-seg--soft" id="tabPrevCritPostes">Postes impactés</button>
      </div>

      <!-- Tab contents -->
      <div id="analysePrevCritTabSynthese" style="margin-top:12px;"></div>
      <div id="analysePrevCritTabRestants" style="margin-top:12px; display:none;"></div>
      <div id="analysePrevCritTabSortants" style="margin-top:12px; display:none;"></div>
      <div id="analysePrevCritTabPostes" style="margin-top:12px; display:none;"></div>
    </div>

    <div class="modal-footer">
      <button type="button" class="sb-btn sb-btn--soft" id="btnAnalysePrevCritModalClose">Fermer</button>
    </div>
  </div>
</div>

<!-- Modal Prévisions — Détail Poste rouge -->
<div class="modal" id="modalAnalysePrevPosteRed" aria-hidden="true">
  <div class="modal-card" style="max-width:1060px;">
    <div class="modal-header">
      <div style="display:flex; flex-direction:column; gap:2px;">
        <div style="font-weight:600;" id="analysePrevPosteRedModalTitle">Détail poste</div>
        <div class="card-sub" id="analysePrevPosteRedModalSub" style="margin:0;"></div>
      </div>
      <button type="button" class="modal-x" id="btnCloseAnalysePrevPosteRedModal" aria-label="Fermer">×</button>
    </div>

    <div class="modal-body">
      <!-- Bandeau contexte -->
      <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center; margin-top:0;">
        <span class="sb-badge sb-badge-accent" id="analysePrevPosteRedBadgeService">Service : —</span>
        <span class="sb-badge" id="analysePrevPosteRedBadgeHorizon">Horizon : —</span>
        <span class="sb-badge" id="analysePrevPosteRedBadgeNext">Prochaine bascule : —</span>
      </div>

      <!-- Synthèse (KPIs) -->
      <div class="card" style="padding:12px; margin-top:12px;">
        <div class="card-title" style="margin-bottom:6px;">Synthèse</div>

        <div class="row" style="gap:12px; flex-wrap:wrap;">
          <div class="card" style="padding:10px; margin:0; min-width:200px; flex:1;">
            <div class="label">Compétences critiques fragiles (horizon)</div>
            <div class="value" id="prevPosteRedKpiFutureFragiles">—</div>
          </div>

          <div class="card" style="padding:10px; margin:0; min-width:200px; flex:1;">
            <div class="label">Dont sans porteur</div>
            <div class="value" id="prevPosteRedKpiFutureSansPorteur">—</div>
          </div>

          <div class="card" style="padding:10px; margin:0; min-width:200px; flex:1;">
            <div class="label">Dont porteur unique</div>
            <div class="value" id="prevPosteRedKpiFuturePorteurUnique">—</div>
          </div>
        </div>

        <div class="card-sub" id="analysePrevPosteRedDecision" style="margin-top:10px;">
          —
        </div>
      </div>

      <!-- Tabs -->
      <div class="sb-segbar" style="margin-top:12px;">
        <button type="button" class="sb-seg sb-seg--soft is-active" id="tabPrevPosteRedSynthese">Synthèse</button>
        <button type="button" class="sb-seg sb-seg--soft" id="tabPrevPosteRedCauses">Causes (compétences)</button>
        <button type="button" class="sb-seg sb-seg--soft" id="tabPrevPosteRedSortants">Porteurs à risque</button>
        <button type="button" class="sb-seg sb-seg--soft" id="tabPrevPosteRedCouverture">Couverture & alternatives</button>
        <button type="button" class="sb-seg sb-seg--soft" id="tabPrevPosteRedVoisins">Postes voisins</button>
      </div>


      <!-- Tab contents -->
      <div id="analysePrevPosteRedTabSynthese" style="margin-top:12px;"></div>
      <div id="analysePrevPosteRedTabCauses" style="margin-top:12px; display:none;"></div>
      <div id="analysePrevPosteRedTabSortants" style="margin-top:12px; display:none;"></div>
      <div id="analysePrevPosteRedTabCouverture" style="margin-top:12px; display:none;"></div>
      <div id="analysePrevPosteRedTabVoisins" style="margin-top:12px; display:none;"></div>
    </div>

    <div class="modal-footer">
      <button type="button" class="sb-btn sb-btn--soft" id="btnAnalysePrevPosteRedModalClose">Fermer</button>
    </div>
  </div>
</div>


</section>
