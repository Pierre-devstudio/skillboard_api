<section id="view-analyse-competences" style="display:none;">
  <style>
    /* Styles locaux au menu (zéro impact global) */
    #view-analyse-competences .analyse-tiles{
      display:grid;
      grid-template-columns: repeat(3, minmax(220px, 1fr));
      gap: 12px;
    }
    @media (max-width: 900px){
      #view-analyse-competences .analyse-tiles{
        grid-template-columns: 1fr;
      }
    }
    #view-analyse-competences .analyse-tile{
      cursor:pointer;
      transition: transform .06s ease, filter .12s ease, box-shadow .12s ease;
    }
    #view-analyse-competences .analyse-tile:hover{
      filter: brightness(0.99);
      transform: translateY(-1px);
    }
    #view-analyse-competences .analyse-tile.active{
      outline: 2px solid color-mix(in srgb, var(--accent) 65%, #ffffff);
      box-shadow: 0 8px 18px rgba(17,24,39,0.08);
    }
    #view-analyse-competences .mini-kpis{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top:12px;
    }
    #view-analyse-competences .mini-kpi{
      border:1px solid #e5e7eb;
      border-radius:10px;
      padding:10px 12px;
      flex:1;
      min-width: 160px;
      background:#fff;
    }
    #view-analyse-competences .tile-sub{
      color: #6b7280;
      font-size: 13px;
      margin-top: 6px;
      line-height: 1.35;
    }
    #view-analyse-competences .tile-hint{
      margin-top: 10px;
      font-size: 12px;
      color: #6b7280;
    }
  </style>

  <div class="card">
    <div class="card-title">Analyse des compétences</div>
    <div class="card-sub">
      Exploitez la cartographie: risques, matching interne, prévisions. Objectif: décider (former, bouger, recruter), pas contempler.
    </div>
  </div>

  <div class="sb-split">
    <!-- Colonne gauche: filtres -->
    <div class="sb-col">
      <div class="card">
        <div class="card-title" style="margin-bottom:6px;">Périmètre</div>
        <div class="card-sub" style="margin:0;">Le filtre s’applique aux indicateurs et aux listes.</div>

        <div class="row" style="flex-direction:column; gap:12px; margin-top:12px;">
          <div class="info-item" style="min-width:0;">
            <div class="label">Service</div>
            <select id="analyseServiceSelect">
              <option value="">Tous les services</option>
            </select>
          </div>

          <div class="info-item" style="min-width:0;">
            <button type="button" class="btn-secondary" id="btnAnalyseReset" style="margin-left:0; width:100%;">
              Réinitialiser
            </button>
          </div>

          <div class="info-item" style="min-width:0;">
            <div class="label">Mode actif</div>
            <div class="value" id="analyseModeLabel">Risques</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-title" style="margin-bottom:6px;">Lecture</div>
        <div class="card-sub" style="margin:0;">
          Cette page ne refait pas la cartographie poste × domaine. Elle transforme les données en décisions.
        </div>
        <div class="card-sub" id="analyseStatus" style="margin-top:10px;">—</div>
      </div>
    </div>

    <!-- Colonne droite: tuiles + détail -->
    <div class="sb-col">
      <div class="analyse-tiles">
        <!-- Tuile Risques -->
        <div class="card analyse-tile active" id="tileRisques" data-mode="risques" role="button" tabindex="0" aria-label="Ouvrir Risques">
          <div class="card-title" style="margin-bottom:2px;">Risques</div>
          <div class="tile-sub">Identifier les fragilités: criticité, couverture, dépendance, concentration.</div>

          <div class="mini-kpis">
            <div class="mini-kpi" data-risk-kpi="postes-fragiles" role="button" tabindex="0" aria-label="Afficher les postes fragiles">
                <div class="label">Postes fragiles</div>
                <div class="value" id="kpiRiskPostes">—</div>
            </div>

            <div class="mini-kpi" data-risk-kpi="critiques-sans-porteur" role="button" tabindex="0" aria-label="Afficher les compétences critiques sans porteur">
                <div class="label">Critiques sans porteur</div>
                <div class="value" id="kpiRiskNoOwner">—</div>
            </div>

            <div class="mini-kpi" data-risk-kpi="porteur-unique" role="button" tabindex="0" aria-label="Afficher les compétences à porteur unique">
                <div class="label">Porteur unique</div>
                <div class="value" id="kpiRiskBus1">—</div>
            </div>
        </div>

          <div class="tile-hint">Décision: prioriser transfert de savoir, formation ciblée, sécurisation.</div>
        </div>

        <!-- Tuile Matching -->
        <div class="card analyse-tile" id="tileMatching" data-mode="matching" role="button" tabindex="0" aria-label="Ouvrir Matching Poste-porteur">
          <div class="card-title" style="margin-bottom:2px;">Matching poste-porteur</div>
          <div class="tile-sub">Trouver les meilleurs porteurs internes, maintenant ou à horizon court, avec écarts.</div>

          <div class="mini-kpis">
            <div class="mini-kpi" data-match-view="titulaire" role="button" tabindex="0" aria-label="Afficher l’adéquation au poste (titulaires)">
              <div class="label">Adéquation au poste</div>
              <div class="value">—</div>
            </div>

            <div class="mini-kpi" data-match-view="candidats" role="button" tabindex="0" aria-label="Afficher les top candidats (hors titulaires)">
              <div class="label">Top candidat</div>
              <div class="value">—</div>
            </div>
          </div>


          <div class="tile-hint">Décision: mobilité, staffing, succession, plan de montée en compétences.</div>
        </div>

        <!-- Tuile Prévisions -->
        <div class="card analyse-tile" id="tilePrevisions" data-mode="previsions" role="button" tabindex="0" aria-label="Ouvrir Prévisions">
          <div class="card-title" style="margin-bottom:2px;">Prévisions</div>
          <div class="tile-sub">Projeter la couverture: sorties, scénarios, postes qui passent en rouge.</div>

          <div class="mini-kpis">
            <div class="mini-kpi">
              <div class="label">Sorties &lt; <span id="prevHorizonLabel">1 an</span></div>
              <div class="value" id="kpiPrevSorties12">—</div>
              <input type="range" id="prevHorizonSlider" min="1" max="5" step="1" value="1" aria-label="Horizon prévision (années)"
                     style="width:100%; margin-top:8px;">
            </div>
            <div class="mini-kpi">
              <div class="label">Critiques impactées</div>
              <div class="value" id="kpiPrevCompImpact">—</div>
            </div>
            <div class="mini-kpi">
              <div class="label">Postes rouges</div>
              <div class="value" id="kpiPrevPostesRed">—</div>
            </div>
          </div>

          <div class="tile-hint">Décision: plan formation/recrutement/mobilité avec horizons.</div>
        </div>
      </div>

      <!-- Détail -->
      <div class="card" style="margin-top:12px;">
        <div style="display:flex; justify-content:space-between; align-items:flex-end; gap:12px; flex-wrap:wrap;">
          <div>
            <div class="card-title" id="analyseDetailTitle" style="margin-bottom:6px;">Risques</div>
            <div class="card-sub" id="analyseDetailSub" style="margin:0;">Liste priorisée à venir.</div>
          </div>
          <div class="card-sub" id="analyseDetailMeta" style="margin:0;">—</div>
        </div>

        <div id="analyseDetailBody" style="margin-top:12px;">
          <div class="card" style="padding:12px; margin:0;">
            <div class="card-sub" style="margin:0;">
              Sélectionnez une tuile pour afficher le contenu. Les listes détaillées arriveront avec l’API dédiée.
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

    <!-- Modal détail Poste (Risques) -->
  <div class="modal" id="modalAnalysePoste" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-header">
        <div style="font-weight:600;" id="analysePosteModalTitle">Détail poste</div>
        <button type="button" class="modal-x" id="btnCloseAnalysePosteModal" aria-label="Fermer">×</button>
      </div>

      <div class="modal-body">
        <div class="card-sub" id="analysePosteModalSub" style="margin-top:0;"></div>

        <!-- Tabs -->
        <div style="display:flex; gap:8px; margin-top:12px; flex-wrap:wrap;">
          <button type="button" class="btn-secondary" id="tabAnalysePosteCompetences" style="margin-left:0;">
            Compétences
          </button>
          <button type="button" class="btn-secondary" id="tabAnalysePosteCouverture" style="margin-left:0;">
            Couverture
          </button>
        </div>

        <!-- Tab contents -->
        <div id="analysePosteTabCompetences" style="margin-top:12px;"></div>
        <div id="analysePosteTabCouverture" style="margin-top:12px; display:none;"></div>
      </div>

      <div class="modal-footer">
        <button type="button" class="btn-secondary" id="btnAnalysePosteModalClose">Fermer</button>
      </div>
    </div>
  </div>

</section>
